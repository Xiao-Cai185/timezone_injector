# 时区注入器 - 使用指南

## 快速开始

### 普通用户

1. **下载二进制文件**，从 `build/` 目录获取：
   - `gui_injector.exe` - 主应用程序
   - `timezonehook.dll` - 通用程序钩子 DLL
   - `browserhook.dll` - 浏览器专用钩子 DLL

2. **将所有文件放在同一目录**

3. **运行 `gui_injector.exe`**

4. **（可选）切换界面语言**：右上角可选择中文或 English

5. **选择目标程序**：
   - 普通程序：直接选择即可
   - **浏览器**（Chrome/Edge/Brave）：选择后勾选"浏览器模式（Hook ICU）"

6. **选择时区**：从下拉菜单选择所需时区

7. **点击"启动并注入"**

目标应用程序将以选定的时区启动！

### 浏览器模式特别说明

浏览器使用 ICU 库处理时区，需要特殊的 Hook 方式：

**步骤**：
1. 选择浏览器可执行文件（如 `chrome.exe`、`msedge.exe`）
2. ✅ **勾选"浏览器模式（Hook ICU）"**（重要！）
3. 选择时区
4. 启动浏览器
5. 打开 `browser_test.html` 验证时区是否生效

**验证方法**：
- 在浏览器中打开 `browser_test.html` 测试页面
- 检查"时区标识符"是否为您选择的时区
- 查看时间显示是否正确

**支持的浏览器**：
- ✅ Google Chrome
- ✅ Microsoft Edge  
- ✅ Brave Browser
- ✅ 其他 Chromium 浏览器
- ❌ Firefox（使用不同实现，暂不支持）

## 支持的时区

已预配置以下时区：

- **UTC+12**：奥克兰
- **UTC+10**：悉尼、墨尔本
- **UTC+9**：东京、首尔
- **UTC+8**：北京/上海、香港、新加坡
- **UTC+7**：曼谷
- **UTC+5:30**：孟买
- **UTC+4**：迪拜
- **UTC+3**：莫斯科、伊斯坦布尔
- **UTC+1**：巴黎/柏林
- **UTC+0**：UTC、伦敦
- **UTC-5**：纽约
- **UTC-6**：芝加哥
- **UTC-7**：丹佛
- **UTC-8**：洛杉矶

## 工作原理

### 技术概述

1. **环境变量**：GUI 设置两个环境变量：
   - `TZ_BIAS`：时区偏移（分钟）
   - `TZ_NAME`：时区显示名称

2. **进程创建**：目标可执行文件以挂起状态创建

3. **DLL 注入**：将 `timezonehook.dll` 注入到目标进程

4. **API 钩子**：DLL 钩住 Windows 时区 API 函数：
   - `GetTimeZoneInformation`
   - `GetDynamicTimeZoneInformation`

5. **进程恢复**：目标进程以自定义时区恢复执行

### 理解时区偏移（Bias）

偏移值表示相对于 UTC 的**分钟**偏移：
- **负值**：UTC 以东的时区（例如，东京 UTC+9 = -540 分钟）
- **正值**：UTC 以西的时区（例如，纽约 UTC-5 = 300 分钟）

这遵循 Windows 时区约定。

## 故障排除

### "DLL file not found"（找不到 DLL 文件）

**问题**：`timezonehook.dll` 不在 `gui_injector.exe` 的同一目录

**解决方案**：
- 确保两个文件在同一文件夹中
- 检查错误消息中的预期 DLL 路径

### "Failed to create process"（创建进程失败）

**可能原因**：
1. 目标可执行文件路径不正确
2. 您没有运行该可执行文件的权限
3. 文件已损坏或不是有效的可执行文件

**解决方案**：
- 验证文件路径
- 尝试以管理员身份运行
- 重新下载目标可执行文件

### "Failed to create remote thread"（创建远程线程失败）

**可能原因**：
1. 目标进程具有反注入保护
2. 权限不足
3. DLL 丢失或无效

**解决方案**：
- 以管理员身份运行
- 检查杀毒软件是否阻止注入
- 验证 `timezonehook.dll` 存在且未损坏
- 某些受保护的进程（系统进程）无法注入

### 时区未改变

**可能原因**：
1. 应用程序缓存时区信息
2. 应用程序使用其他时区 API
3. 应用程序从其他来源读取时区

**解决方案**：
- 重启应用程序
- 某些应用程序可能与此方法不兼容
- 尝试不同的应用程序以验证工具是否正常工作

## 高级用法

### 命令行注入（传统方式）

对于高级用户，也提供了命令行工具：

```batch
injector.exe <目标.exe> <timezonehook.dll的路径>
```

**注意**：使用 CLI 工具前必须手动设置环境变量：

```batch
set TZ_BIAS=-540
set TZ_NAME=Tokyo (UTC+9)
injector.exe notepad.exe timezonehook.dll
```

### 自定义时区

要添加自定义时区，您需要：
1. 修改 `gui_injector.cpp`
2. 向 `timezones` 向量添加条目
3. 重新编译应用程序

示例：
```cpp
{ L"自定义 (UTC+3:30)", -210 },  // 3.5 小时 * 60 分钟 = 210
```

## 限制说明

### 此工具可以做什么
- ✅ 钩住标准 Windows 时区 API
- ✅ 适用于大多数 Windows 应用程序
- ✅ 支持任何时区偏移
- ✅ 注入到用户模式应用程序

### 此工具不能做什么
- ❌ 注入到系统/受保护的进程
- ❌ 适用于使用内核模式时区查询的应用程序
- ❌ 绕过反作弊或反篡改系统
- ❌ 更改系统范围的时区（仅影响注入的进程）

## 安全考虑

### 这安全吗？

- 该工具使用标准 Windows API
- 没有恶意代码或后门
- 开源 - 您可以审查代码
- DLL 注入是许多工具使用的合法技术

### 杀毒软件警告

某些杀毒软件可能会标记此工具，因为：
- 它使用 DLL 注入技术
- 它修改进程内存
- 它钩住 API 函数

这是**误报**。该工具不包含恶意软件。

### 何时使用管理员权限

在以下情况下可能需要以管理员身份运行：
- 目标应用程序需要提升权限
- 遇到"访问被拒绝"错误
- 注入失败并显示错误代码 5

## 使用示例

### 示例 1：测试 Web 应用程序

您正在开发 Web 应用程序，需要测试它在不同时区下的行为：

1. 选择浏览器可执行文件（例如 `chrome.exe`）
2. 选择"东京 (UTC+9)"
3. 点击"Launch & Inject"
4. 您的浏览器将以东京时区启动

### 示例 2：在不同时区运行游戏

某些游戏有时区特定的事件：

1. 选择游戏可执行文件
2. 选择所需时区
3. 启动游戏
4. 游戏将看到自定义时区

### 示例 3：测试时间敏感软件

测试根据时区表现不同的软件：

1. 选择您的应用程序
2. 使用下拉菜单测试不同时区
3. 验证每个时区的行为

## 常见问题

**问：我需要安装什么吗？**
答：不需要，只需下载两个文件并运行它们。

**问：这会改变我的系统时区吗？**
答：不会，它只影响注入的进程。

**问：我可以注入到多个进程吗？**
答：可以，为不同进程多次运行该工具。

**问：这在 Windows 11 上可以用吗？**
答：可以，它适用于 Windows 7、8、10 和 11。

**问：我可以将其用于在线游戏吗？**
答：技术上可以，但这可能违反服务条款。使用风险自负。

**问：时区改变了但时间没变？**
答：此工具仅更改时区信息，不更改实际系统时间。

## 从源码构建

详见 [README.md](README.md) 中的构建说明。

## 支持

如有问题、疑问或功能请求：
- 在 GitHub 上开启 issue
- 检查现有 issue 以查找解决方案
- 报告问题时提供错误代码和详细信息

## 许可证

详见 [LICENSE](LICENSE) 文件。
